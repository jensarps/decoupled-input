(function (name, definition, global) {if (typeof define === "function") {define(definition);} else if (typeof module !== "undefined" && module.exports) {module.exports = definition();} else {global[name] = definition();}})("hipe", function () {'use strict';var module$src$InputController={},InputController$$module$src$InputController=function(){this.deviceHandlers={};this.bindings={};this.input={}};
InputController$$module$src$InputController.prototype={version:"1.0.0",bindings:null,deviceHandlers:null,input:null,setBindings:function(a){this._processBindings(a);Object.keys(this.deviceHandlers).forEach(function(a){this.deviceHandlers[a].bindings=this.bindings[a]||{};this.deviceHandlers[a].input=this.input},this)},_processBindings:function(a){var b={}.toString;Object.keys(a).forEach(function(d){var c=a[d],e="[object Array]"==b.call(c);this.input[d]=0;if(e)for(var e=0,f=c.length;e<f;e++)this._applyBinding(c[e],
d);else this._applyBinding(c,d)},this)},_applyBinding:function(a,b){this.bindings[a.device]||(this.bindings[a.device]={});this.bindings[a.device][a.inputId]={description:b,down:!!a.down,up:!!a.up,invert:!!a.invert}},registerDeviceHandler:function(a){var b=a.prototype.name;this.deviceHandlers[b]=new a(this.bindings[b]||{},this.input)},registerDeviceHandlers:function(a){a.forEach(this.registerDeviceHandler,this)},getDeviceHandler:function(a){var b=this.deviceHandlers[a];if(!b)throw Error('No handler with the name "'+
a+'" registered.');return b},configureDeviceHandler:function(a,b,d){return this.getDeviceHandler(a).configure(b,d)},destroy:function(){Object.keys(this.deviceHandlers).forEach(function(a){this.deviceHandlers[a].destroy()},this);this.deviceHandlers={}},startDetecting:function(a){var b=function(b){b.timestamp=Date.now();a(b)};Object.keys(this.deviceHandlers).forEach(function(a){a=this.deviceHandlers[a];a._detectCallback=b;a.isDetecting=!0},this)},stopDetecting:function(){Object.keys(this.deviceHandlers).forEach(function(a){a=
this.deviceHandlers[a];a._detectCallback=null;a.isDetecting=!1},this)}};module$src$InputController.module$exports=InputController$$module$src$InputController;module$src$InputController.module$exports&&(module$src$InputController=module$src$InputController.module$exports);var module$src$MouseHandler={},MouseHandler$$module$src$MouseHandler=function(a,b){this.bindings=a;this.input=b;this.input.mouseX=0;this.input.mouseY=0;var d=!1,c=null;["webkitPointerLockElement","mozPointerLockElement","pointerLockElement"].forEach(function(a){a in document&&(d=!0,c=a)},this);this.hasPointerLockSupport=d;this.pointerLockElementProperty=c;document.addEventListener("mousemove",this.moveListener=this.onMouseMove.bind(this),!1);document.addEventListener("mousedown",this.downListener=
this.onMouseDown.bind(this),!1);document.addEventListener("mouseup",this.upListener=this.onMouseUp.bind(this),!1);document.addEventListener("contextmenu",(this.ctxListener=function(a){a.preventDefault()}).bind(this),!1);window.addEventListener("resize",this.resizeListener=this.onResize.bind(this),!1);this.onResize()};
MouseHandler$$module$src$MouseHandler.prototype={name:"mouse",configurableProperties:["infiniteXAxis","infiniteYAxis"],hasPointerLockSupport:!1,pointerLockElementProperty:null,movementProperty:"",infiniteXAxis:!1,infiniteYAxis:!1,width:0,height:0,configure:function(a,b){if(-1===this.configurableProperties.indexOf(a))throw Error("Property "+a+" is not configurable.");this[a]=b;return!0},onMouseMove:function(a){var b,d,c,e;c=this.width;b=c/2;e=this.height;d=e/2;var f=this.hasPointerLockSupport&&null!==
document[this.pointerLockElementProperty];this._initialized||(["webkitMovement","mozMovement","movement"].forEach(function(b){b+"X"in a&&(this.movementProperty=b)},this),this.input.mouseX=a.pageX-(f?a[this.movementProperty+"X"]:0),this.input.mouseY=a.pageY-(f?a[this.movementProperty+"Y"]:0),this._initialized=!0);var g=a[this.movementProperty+"X"],h=a[this.movementProperty+"Y"];f?(c=this.clamp(0,c,this.input.mouseX+g),e=this.clamp(0,e,this.input.mouseY+h)):(c=a.pageX,e=a.pageY);b=this.infiniteXAxis?
f?g:c-this.input.mouseX:-(c-b)/b;d=this.infiniteYAxis?f?h:e-this.input.mouseY:-(e-d)/d;this.isDetecting?(c=Math.abs(this.input.mouseX-c),e=Math.abs(this.input.mouseY-e),this._detectCallback({device:"mouse",inputId:c>e?"x":"y",isAxis:!0})):(this.input.mouseX=c,this.input.mouseY=e,"x"in this.bindings&&(c=this.bindings.x,this.input[c.description]=c.invert?-1*b:b),"y"in this.bindings&&(c=this.bindings.y,this.input[c.description]=c.invert?-1*d:d))},onMouseDown:function(a){this.isDetecting?this._detectCallback({device:"mouse",
inputId:a.button,isAxis:!1}):a.button in this.bindings&&(a=this.bindings[a.button],a.down&&(this.input[a.description]=1))},onMouseUp:function(a){!this.isDetecting&&a.button in this.bindings&&(a=this.bindings[a.button],a.up&&(this.input[a.description]=0))},onResize:function(){this.width=window.innerWidth;this.height=window.innerHeight},clamp:function(a,b,d){return Math.min(b,Math.max(a,d))},destroy:function(){document.removeEventListener("mousemove",this.moveListener,!1);document.removeEventListener("mousedown",
this.downListener,!1);document.removeEventListener("mouseup",this.upListener,!1);document.removeEventListener("contextmenu",this.ctxListener,!1);window.removeEventListener("resize",this.resizeListener,!1)}};module$src$MouseHandler.module$exports=MouseHandler$$module$src$MouseHandler;module$src$MouseHandler.module$exports&&(module$src$MouseHandler=module$src$MouseHandler.module$exports);var module$src$KeyboardHandler={},KeyboardHandler$$module$src$KeyboardHandler=function(a,b){this.bindings=a;this.input=b;document.addEventListener("keyup",this.upListener=this.onKeyUp.bind(this),!1);document.addEventListener("keydown",this.downListener=this.onKeyDown.bind(this),!1)};
KeyboardHandler$$module$src$KeyboardHandler.prototype={name:"keyboard",configurableProperties:[],isDetecting:!1,configure:function(a,b){if(-1===this.configurableProperties.indexOf(a))throw Error("Property "+a+" is not configurable.");this[a]=b;return!0},onKeyDown:function(a){if(this.isDetecting)this._detectCallback({device:"keyboard",inputId:a.keyCode,isAxis:!1});else{var b=String.fromCharCode(a.keyCode),d=b.toLowerCase(),c;a.keyCode in this.bindings?c=this.bindings[a.keyCode]:b in this.bindings?
c=this.bindings[b]:d in this.bindings&&(c=this.bindings[d]);c&&c.down&&(this.input[c.description]=1)}},onKeyUp:function(a){if(!this.isDetecting){var b=String.fromCharCode(a.keyCode),d=b.toLowerCase(),c;a.keyCode in this.bindings?c=this.bindings[a.keyCode]:b in this.bindings?c=this.bindings[b]:d in this.bindings&&(c=this.bindings[d]);c&&c.up&&(this.input[c.description]=0)}},destroy:function(){document.removeEventListener("keyup",this.upListener,!1);document.removeEventListener("keydown",this.downListener,
!1)}};module$src$KeyboardHandler.module$exports=KeyboardHandler$$module$src$KeyboardHandler;module$src$KeyboardHandler.module$exports&&(module$src$KeyboardHandler=module$src$KeyboardHandler.module$exports);var module$src$GamepadHandler={},GamepadHandler$$module$src$GamepadHandler=function(a,b){this.bindings=a;this.input=b;this.gamepads=[];this.prevRawGamepadTypes=[];this.prevTimestamps=[];this.buttonStates=[];this.axisValues=[];this.init()};
GamepadHandler$$module$src$GamepadHandler.prototype={name:"gamepad",configurableProperties:["deadzone"],deadzone:0.01,buttonStates:null,axisValues:null,gamepads:null,isPolling:!1,prevRawGamepadTypes:null,prevTimestamps:null,configure:function(a,b){if(-1===this.configurableProperties.indexOf(a))throw Error("Property "+a+" is not configurable.");this[a]=b;return!0},init:function(){if(navigator.webkitGetGamepads||navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/"))window.addEventListener("MozGamepadConnected",
this.connectListener=this.onGamepadConnect.bind(this),!1),window.addEventListener("MozGamepadDisconnected",this.disconnectListener=this.onGamepadDisconnect.bind(this),!1),(navigator.webkitGamepads||navigator.webkitGetGamepads)&&this.startPolling()},onGamepadConnect:function(a){this.gamepads.push(a.gamepad);this.startPolling()},onGamepadDisconnect:function(a){for(var b=this.gamepads-1;0<=b;b--)if(this.gamepads[b].index==a.gamepad.index){this.gamepads.splice(b,1);break}0===this.gamepads.length&&this.stopPolling()},
startPolling:function(){this.isPolling||(this.isPolling=!0,this.tick())},stopPolling:function(){this.isPolling=!1},tick:function(){if(this.isPolling){var a=this.tick.bind(this);window.requestAnimationFrame?window.requestAnimationFrame(a):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(a):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(a)}this.pollStatus()},pollStatus:function(){this.pollGamepads();for(var a=0,b=this.gamepads.length;a<b;a++){var d=this.gamepads[a];
d.timestamp&&d.timestamp==this.prevTimestamps[a]||(this.prevTimestamps[a]=d.timestamp,this.onStatusChanged(a))}},pollGamepads:function(){var a=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads,b,d;if(a){this.gamepads.length=0;var c=!1;b=0;for(d=a.length;b<d;b++)typeof a[b]!=this.prevRawGamepadTypes[b]&&(c=!0,this.prevRawGamepadTypes[b]=typeof a[b]),a[b]&&this.gamepads.push(a[b]);if(c)for(this.buttonStates.length=0,b=this.axisValues.length=0,d=this.gamepads.length;b<
d;b++){var a=this.gamepads[b],e=this.buttonStates[b]=[];a.buttons.forEach(function(a,b){e[b]=a},this);var f=this.axisValues[b]=[];a.axes.forEach(function(a,b){f[b]=Math.abs(a)>this.deadzone?a:0},this)}}},onStatusChanged:function(a){var b=this.gamepads[a],d=this.buttonStates[a];a=this.axisValues[a];var c,e,f;c=0;for(e=b.buttons.length;c<e;c++){var g=b.buttons[c],h=d[c];f="button-"+c;h!=g&&(this.isDetecting?this._detectCallback({device:"gamepad",inputId:f,isAxis:!1}):(h=g>h?"down":"up",f in this.bindings&&
(f=this.bindings[f],f[h]&&(this.input[f.description]=g))),d[c]=g)}c=0;for(e=b.axes.length;c<e;c++)d=b.axes[c],Math.abs(d)<=this.deadzone&&(d=0),g="axis-"+c,this.isDetecting&&a[c]!=d?this._detectCallback({device:"gamepad",inputId:g,isAxis:!0}):g in this.bindings&&(f=this.bindings[g],f.invert&&(d*=-1),this.input[f.description]=d),a[c]=d},destroy:function(){this.stopPolling();window.removeEventListener("MozGamepadConnected",this.connectListener,!1);window.removeEventListener("MozGamepadDisconnected",
this.disconnectListener,!1)}};module$src$GamepadHandler.module$exports=GamepadHandler$$module$src$GamepadHandler;module$src$GamepadHandler.module$exports&&(module$src$GamepadHandler=module$src$GamepadHandler.module$exports);var module$src$SpeechHandler={},SpeechHandler$$module$src$SpeechHandler=function(a,b){this.bindings=a;this.input=b;if("webkitSpeechRecognition"in window){var d=this.recognition=new window.webkitSpeechRecognition;d.continuous=!0;d.interimResults=!0;d.onstart=this._startHandler.bind(this);d.onerror=this._errorHandler.bind(this);d.onend=this._endHandler.bind(this);d.onresult=this._resultHandler.bind(this)}};
SpeechHandler$$module$src$SpeechHandler.prototype={name:"speech",configurableProperties:["language","requiredConfidence","onRecognitionEnded"],recognition:null,isRecognizing:!1,isActive:!1,language:"en-US",requiredConfidence:0.5,onRecognitionEnded:null,configure:function(a,b){if(-1===this.configurableProperties.indexOf(a))throw Error("Property "+a+" is not configurable.");this[a]=b;return!0},_startHandler:function(){this.isRecognizing=!0},_errorHandler:function(){this.isActive=this.isRecognizing=
!1;this.onRecognitionEnded&&this.onRecognitionEnded()},_endHandler:function(){this.isActive=this.isRecognizing=!1;this.onRecognitionEnded&&this.onRecognitionEnded()},_resultHandler:function(a){if(this.isActive)for(var b=a.resultIndex;b<a.results.length;++b){var d=a.results[b],c=d[0];if(d.isFinal||c.confidence>=this.requiredConfidence)d=c.transcript,d in this.bindings&&(this.recognition.stop(),this.input[this.bindings[d].description]=1)}},start:function(){this.isActive||(this.isRecognizing||(this.recognition.lang=
this.language,this.recognition.start()),this.isActive=!0)},stop:function(){this.isActive=!1},destroy:function(){}};module$src$SpeechHandler.module$exports=SpeechHandler$$module$src$SpeechHandler;module$src$SpeechHandler.module$exports&&(module$src$SpeechHandler=module$src$SpeechHandler.module$exports);var module$build$bundle={},InputController$$module$build$bundle=module$src$InputController,MouseHandler$$module$build$bundle=module$src$MouseHandler,KeyboardHandler$$module$build$bundle=module$src$KeyboardHandler,GamepadHandler$$module$build$bundle=module$src$GamepadHandler,SpeechHandler$$module$build$bundle=module$src$SpeechHandler,bundle$$module$build$bundle=new InputController$$module$build$bundle;
bundle$$module$build$bundle.registerDeviceHandlers([MouseHandler$$module$build$bundle,KeyboardHandler$$module$build$bundle,GamepadHandler$$module$build$bundle,SpeechHandler$$module$build$bundle]);module$build$bundle.module$exports=bundle$$module$build$bundle;module$build$bundle.module$exports&&(module$build$bundle=module$build$bundle.module$exports);
return module$build$bundle; }, this);
